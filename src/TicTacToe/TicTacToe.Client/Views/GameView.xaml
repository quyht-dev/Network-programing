<UserControl x:Class="TicTacToe.Client.Views.GameView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="520" d:DesignWidth="900"
             SizeChanged="UserControl_SizeChanged">

    <UserControl.Resources>
        <SolidColorBrush x:Key="BgBrush" Color="#0B1220"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#111B2E"/>
        <SolidColorBrush x:Key="TextBrush" Color="#E6ECFF"/>
        <SolidColorBrush x:Key="SubTextBrush" Color="#9FB0D0"/>
        <SolidColorBrush x:Key="BorderBrushSoft" Color="#26314B"/>
        
        <Style x:Key="CellButton" TargetType="Button">
            <Setter Property="Background" Value="#0E172A"/>
            <Setter Property="BorderBrush" Value="#27314A"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1" CornerRadius="10">
                            <Viewbox Margin="10">
                                <TextBlock x:Name="Txt" Text="{TemplateBinding Content}" FontWeight="Black"/>
                            </Viewbox>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1E293B"/>
                            </Trigger>
                            <DataTrigger Binding="{Binding Text}" Value="X">
                                <Setter TargetName="Txt" Property="Foreground" Value="#3B82F6"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Text}" Value="O">
                                <Setter TargetName="Txt" Property="Foreground" Value="#EF4444"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource BgBrush}">
        <Grid x:Name="MainLayoutGrid" Margin="15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="ColSidebar" Width="300" MinWidth="250"/>
                <ColumnDefinition x:Name="ColSpacing" Width="15"/>
                <ColumnDefinition x:Name="ColBoard" Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition x:Name="RowSidebar" Height="*"/>
                <RowDefinition x:Name="RowSpacing" Height="0"/>
                <RowDefinition x:Name="RowBoard" Height="0"/>
            </Grid.RowDefinitions>

            <Border x:Name="SidebarBorder" Grid.Column="0" Grid.Row="0" 
                    Background="{StaticResource PanelBrush}" CornerRadius="15" Padding="15" 
                    BorderThickness="1" BorderBrush="{StaticResource BorderBrushSoft}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel>
                        <TextBlock Text="TIC-TAC-TOE" FontSize="20" FontWeight="Black" Foreground="{StaticResource TextBrush}"/>
                        <TextBlock Text="Trạng thái kết nối" FontSize="11" Foreground="{StaticResource SubTextBrush}"/>
                    </StackPanel>

                    <UniformGrid Grid.Row="1" Columns="1" Margin="0,15">
                        <Button Content="Kết nối Server" Height="40" Margin="0,0,0,8" Command="{Binding ConnectCommand}" Background="#1E3A8A" Foreground="White" BorderThickness="0">
                            <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="8"/></Style></Button.Resources>
                        </Button>
                        <Button Content="Tìm trận ngay" Height="40" Command="{Binding FindMatchCommand}" Background="#065F46" Foreground="White" BorderThickness="0">
                            <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="8"/></Style></Button.Resources>
                        </Button>
                    </UniformGrid>

                    <Border Grid.Row="2" Background="#0B1220" CornerRadius="10" Padding="10" VerticalAlignment="Top">
                        <StackPanel>
                            <TextBlock Text="THÔNG BÁO" FontSize="10" FontWeight="Bold" Foreground="{StaticResource SubTextBrush}"/>
                            <TextBlock Text="{Binding StatusText}" Margin="0,5,0,0" Foreground="White" TextWrapping="Wrap" FontSize="13"/>
                        </StackPanel>
                    </Border>
                    
                    <TextBlock Grid.Row="3" Text="Project Network Programming" FontSize="10" Foreground="#475569" HorizontalAlignment="Center"/>
                </Grid>
            </Border>

            <Border x:Name="BoardBorder" Grid.Column="2" Grid.Row="0" 
                    Background="{StaticResource PanelBrush}" CornerRadius="15" Padding="15" 
                    BorderThickness="1" BorderBrush="{StaticResource BorderBrushSoft}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel LastChildFill="False">
                        <StackPanel DockPanel.Dock="Left">
                            <TextBlock Text="Đang thi đấu" FontSize="16" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="{Binding RoomId, StringFormat='Phòng: {0}'}" FontSize="11" Foreground="{StaticResource SubTextBrush}"/>
                        </StackPanel>
                        
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Border Background="#1E293B" Padding="10,5" CornerRadius="6" Margin="0,0,5,0">
                                <TextBlock Text="{Binding MySymbol, StringFormat='BẠN: {0}'}" Foreground="#3B82F6" FontWeight="Bold"/>
                            </Border>
                            <Border Background="#F59E0B" Padding="10,5" CornerRadius="6">
                                <TextBlock Text="{Binding Turn, StringFormat='LƯỢT: {0}'}" Foreground="Black" FontWeight="Bold"/>
                            </Border>
                        </StackPanel>
                    </DockPanel>

                    <Viewbox Grid.Row="1" Margin="10" Stretch="Uniform">
                        <ItemsControl ItemsSource="{Binding Cells}" Width="400" Height="400">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Rows="3" Columns="3"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource CellButton}" Margin="5" 
                                            Content="{Binding Text}" 
                                            IsEnabled="{Binding IsEnabled}"
                                            Command="{Binding DataContext.CellClickCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Viewbox>
                </Grid>
            </Border>
        </Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="LayoutStates">
                <VisualState x:Name="WideState" />

                <VisualState x:Name="NarrowState">
                    <Storyboard>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ColSidebar" Storyboard.TargetProperty="Width">
                            <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static GridLength.Auto}"/>
                        </ObjectAnimationUsingKeyFrames>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ColSpacing" Storyboard.TargetProperty="Width">
                            <DiscreteObjectKeyFrame KeyTime="0" Value="0.0"/>
                        </ObjectAnimationUsingKeyFrames>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ColBoard" Storyboard.TargetProperty="Width">
                            <DiscreteObjectKeyFrame KeyTime="0" Value="0.0"/>
                        </ObjectAnimationUsingKeyFrames>

                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RowSpacing" Storyboard.TargetProperty="Height">
                            <DiscreteObjectKeyFrame KeyTime="0" Value="15.0"/>
                        </ObjectAnimationUsingKeyFrames>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RowBoard" Storyboard.TargetProperty="Height">
                            <DiscreteObjectKeyFrame KeyTime="0" Value="*"/>
                        </ObjectAnimationUsingKeyFrames>

                        <Int32AnimationUsingKeyFrames Storyboard.TargetName="BoardBorder" Storyboard.TargetProperty="(Grid.Row)">
                            <DiscreteInt32KeyFrame KeyTime="0" Value="2"/>
                        </Int32AnimationUsingKeyFrames>
                        <Int32AnimationUsingKeyFrames Storyboard.TargetName="BoardBorder" Storyboard.TargetProperty="(Grid.Column)">
                            <DiscreteInt32KeyFrame KeyTime="0" Value="0"/>
                        </Int32AnimationUsingKeyFrames>
                    </Storyboard>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</UserControl>